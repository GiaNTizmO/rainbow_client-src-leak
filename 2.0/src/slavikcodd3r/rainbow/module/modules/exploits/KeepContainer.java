package slavikcodd3r.rainbow.module.modules.exploits;

import net.minecraft.client.gui.GuiScreenBook;
import net.minecraft.client.gui.inventory.GuiEditSign;
import net.minecraft.network.play.client.C0DPacketCloseWindow;
import net.minecraft.network.play.server.S2EPacketCloseWindow;
import slavikcodd3r.rainbow.event.EventTarget;
import slavikcodd3r.rainbow.event.events.PacketSendEvent;
import slavikcodd3r.rainbow.event.events.UpdateEvent;
import slavikcodd3r.rainbow.module.Module;
import slavikcodd3r.rainbow.utils.ClientUtils;

import org.lwjgl.input.Keyboard;
import net.minecraft.client.gui.GuiChat;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.GuiScreen;

@Module.Mod (displayName = "KeepContainer")
public class KeepContainer extends Module
{
    public GuiScreen screen;
    
    public KeepContainer() {
        final Minecraft mc = ClientUtils.mc();
        this.screen = ClientUtils.mc().currentScreen;
    }
    
    @EventTarget
    private void onUpdate(final UpdateEvent event) {
        if (ClientUtils.mc().currentScreen == null) {
            return;
        }
        if (ClientUtils.mc().currentScreen instanceof GuiChat) {
            return;
        }
        if (Keyboard.isKeyDown(210)) {
            Minecraft.getMinecraft();
            this.screen = ClientUtils.mc().currentScreen;
            ClientUtils.mc().setIngameFocus();
        }
        if (!(ClientUtils.mc().currentScreen instanceof GuiEditSign) && !(ClientUtils.mc().currentScreen instanceof GuiScreenBook)) {
            return;
        }
    }
    
    @EventTarget
    public void onPacket(final PacketSendEvent event) {
        if (event.getPacket() instanceof C0DPacketCloseWindow) {
            event.setCancelled(true);
        }
    }
    
    @Override
    public void disable() {
        ClientUtils.mc().setIngameNotInFocus();
        ClientUtils.mc().displayGuiScreen(this.screen);
        super.disable();
    }
    
    @Override
    public void enable() {
        Minecraft.getMinecraft();
        this.screen = ClientUtils.mc().currentScreen;
        super.enable();
    }
}
